<template>
  <Layout>
    <div class="thanks">
      <div class="thanks-inner">
        <p class="thanks-title">ãŠç”³è¾¼ã¿å—ä»˜ã„ãŸã—ã¾ã—ãŸã€‚</p>
        <p class="thanks-text">
          ãŠç”³è¾¼ã¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
          <br />
          ã“ã“ã‹ã‚‰æ–°ã—ã„ä¸€æ­©ãŒå§‹ã¾ã‚Šã¾ã™ã€‚ç›®æ¨™é”æˆã«å‘ã‘ã¦ã€
          <br />
          æœ€å¾Œã¾ã§ã—ã£ã‹ã‚Šã‚µãƒãƒ¼ãƒˆã„ãŸã—ã¾ã™ã€‚
          <br />
          <br />
          <span class="thanks-text-bold">ğŸ“¦ æ•™æã®ç™ºé€ã«ã¤ã„ã¦</span>
          <br />
          ã”å…¥é‡‘ç¢ºèªå¾Œã€
          <span class="thanks-text-bold-red">2å–¶æ¥­æ—¥ä»¥å†…ã«æ•™æã‚’ç™ºé€</span>
          ã„ãŸã—ã¾ã™ã€‚
          <br />
          â€» èƒ½ã‚»ãƒ³ã§ã¯ã€æ•™æç™ºé€ã®æ¢±åŒ…ã«å†ç”Ÿç´™ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã¾ã™ã€‚
          <br />
          ï¼ˆæ•™æãŒå°‘ãªã„å ´åˆã¯ãƒ¬ã‚¿ãƒ¼ãƒ‘ãƒƒã‚¯ç­‰ã§ãŠé€ã‚Šã„ãŸã—ã¾ã™ã€‚ï¼‰
        </p>
      </div>
    </div>
    <!-- A8ãƒãƒƒãƒˆ æˆæœã‚¿ã‚° -->
    <span id="a8sales"></span>
  </Layout>
</template>

<static-query>
query {
  metadata {
    siteName
    siteUrl
    siteDescription
  }
}
</static-query>

<script>
  export default {
    metaInfo() {
      return {
        titleTemplate: "ãŠç”³è¾¼ã¿å—ä»˜ã„ãŸã—ã¾ã—ãŸã€‚ï½œèƒ½ã‚»ãƒ³-åˆæ ¼ã¸ã®è¿‘é“-",
        meta: [
          {
            name: "description",
            content:
              "é›»æ°—ã€å»ºç¯‰ã€è¨­å‚™é–¢é€£ã‚’ä¸­å¿ƒã¨ã—ãŸå—é¨“å¯¾ç­–è¬›ç¿’ä¼šã‚’é–‹å‚¬ã—ã¦ã„ã¾ã™èƒ½ã‚»ãƒ³ã®ãƒšãƒ¼ã‚¸ã§ã™ã€‚",
          },
          {
            key: `og:title`,
            property: `og:title`,
            content: `ãŠç”³è¾¼ã¿å—ä»˜ã„ãŸã—ã¾ã—ãŸã€‚ï½œèƒ½ã‚»ãƒ³-åˆæ ¼ã¸ã®è¿‘é“-`,
          },
          {
            key: `og:url`,
            property: `og:url`,
            content: `${this.$static.metadata.siteUrl}/guide`,
          },
        ],
      };
    },

    // mounted() {
    //   (function () {
    //     var uqid = "ad5bd9cGM8364M65";
    //     var gid = "228";
    //     var uid =
    //       Date.now().toString(36) + Math.random().toString(36).substr(2, 9);

    //     // ç›´å‰ã®ãƒšãƒ¼ã‚¸ï¼ˆãƒªãƒ•ã‚¡ãƒ©ãƒ¼ï¼‰ã®ãƒ‘ã‚¹ã‹ã‚‰uid2ã‚’å–å¾—
    //     var referrerPath = new URL(document.referrer).pathname;
    //     var uid2 = referrerPath.replace(/^\/|\/$/g, ""); // ãƒ‘ã‚¹ã®å‰å¾Œã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’é™¤å»

    //     var af = "";
    //     var pid = "";
    //     var amount = "";

    //     var a = document.createElement("script");
    //     a.src = "//act.gro-fru.net/ac/action_js.php";
    //     a.id = "afadaction-" + Date.now();
    //     a.addEventListener("load", function () {
    //       new fpcAction(a.id).groupAction(
    //         gid,
    //         af,
    //         [uid, uid2],
    //         pid,
    //         amount,
    //         uqid
    //       );
    //     });
    //     document.head.appendChild(a);
    //   })();
    // },
    mounted() {
      // A8ãƒãƒƒãƒˆ æˆæœã‚¿ã‚°
      // æ³¨æ–‡ç•ªå·ã‚’å–å¾—ï¼ˆã‚·ã‚¹ãƒ†ãƒ å´ã§å‹•çš„ã«å€¤ã‚’æ¸¡ã—ã¦ãã ã•ã„ï¼‰
      // å–å¾—æ–¹æ³•ã®å„ªå…ˆé †ä½:
      // 1. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆ?order_number=xxx ã¾ãŸã¯ ?orderNumber=xxxï¼‰
      // 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
      // 3. ãƒšãƒ¼ã‚¸å†…ã®dataå±æ€§ï¼ˆ<body data-order-number="xxx">ï¼‰
      const urlParams = new URLSearchParams(window.location.search);
      let orderNumber =
        urlParams.get("order_number") ||
        urlParams.get("orderNumber") ||
        sessionStorage.getItem("orderNumber") ||
        localStorage.getItem("orderNumber") ||
        document.body.getAttribute("data-order-number") ||
        "";

      if (!orderNumber) {
        const fallbackId =
          "ORD-" +
          Date.now() +
          "-" +
          Math.random().toString(36).substr(2, 9).toUpperCase();
        orderNumber = fallbackId;
        sessionStorage.setItem("orderNumber", fallbackId);
        localStorage.setItem("orderNumber", fallbackId);
      }

      // æ³¨æ–‡ç•ªå·ãŒå–å¾—ã§ããªã„å ´åˆã¯ç©ºæ–‡å­—åˆ—ï¼ˆå›ºå®šå€¤ã¯ä½¿ç”¨ã—ãªã„ï¼‰
      // ã‚·ã‚¹ãƒ†ãƒ å´ã§å¿…ãšæ³¨æ–‡ç•ªå·ã‚’æ¸¡ã™ã‚ˆã†ã«ã—ã¦ãã ã•ã„

      // AFI-Bç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è­˜åˆ¥IDã‚’ç”Ÿæˆï¼ˆNGæ–‡å­—ã‚’å‰Šé™¤ï¼‰
      const sanitizeUserId = (str) => {
        if (!str) return "";
        // OKæ–‡å­—ã®ã¿æ®‹ã™: è‹±æ•°å­—ï¼ˆa-z, A-Z, 0-9ï¼‰ã¨ . - _ *
        // NGæ–‡å­—ã‚’å‰Šé™¤: æ—¥æœ¬èªã€? ! & "" ' \ / % # + = $ { } [ ] ; : | ã‚¹ãƒšãƒ¼ã‚¹ãªã©
        let sanitized = str.replace(/[^a-zA-Z0-9.-_*]/g, "");
        // å…ˆé ­ãƒ»æœ€å¾Œã®åŠè§’/å…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ï¼ˆå¿µã®ãŸã‚ï¼‰
        sanitized = sanitized.replace(/^[\s\u3000]+|[\s\u3000]+$/g, "");
        return sanitized;
      };

      const userId = sanitizeUserId(orderNumber);

      // a8sales.jsã‚’èª­ã¿è¾¼ã‚€
      const script1 = document.createElement("script");
      script1.src = "//statics.a8.net/a8sales/a8sales.js";
      script1.onload = () => {
        // a8sales.jsèª­ã¿è¾¼ã¿å¾Œã«a8salesé–¢æ•°ã‚’å‘¼ã³å‡ºã™
        if (typeof a8sales === "function") {
          a8sales({
            pid: "s00000027188001",
            order_number: orderNumber, // ã‚·ã‚¹ãƒ†ãƒ å´ã§å‹•çš„ã«å€¤ã‚’æ¸¡ã—ã¦ãã ã•ã„
            currency: "JPY",
            items: [
              {
                code: "a8",
                price: 1,
                quantity: 1,
              },
            ],
            total_price: 1,
          });
        }
      };
      document.body.appendChild(script1);

      // AFI-B LPCV CV ã‚¿ã‚°
      if (!window.afblpcvCvConf) {
        window.afblpcvCvConf = [];
      }
      window.afblpcvCvConf.push({
        siteId: "cd77d6d9",
        commitData: {
          pid: "Q15743i",
          u: userId || "", // æ³¨æ–‡ç•ªå·ã‹ã‚‰NGæ–‡å­—ã‚’å‰Šé™¤ã—ãŸå€¤
        },
      });

      const script2 = document.createElement("script");
      script2.src =
        "https://t.afi-b.com/jslib/lpcv.js?cid=cd77d6d9&pid=Q15743i";
      script2.async = true;
      document.body.appendChild(script2);
    },
  };
</script>

<style lang="scss" scoped>
  .thanks {
    background-color: #ebf7ff;
    padding: 50px;
  }
  .thanks-inner {
    background-color: white;
    font-family: "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif;
    padding: 30px 0;
    margin: 0 auto;
    max-width: 580px;
  }

  .thanks-title {
    font-size: 28px;
    margin: 0;
    padding-bottom: 10px;
    position: relative;
    line-height: 1.5;
    font-weight: 700;
    text-align: center;
  }

  .thanks-title::after {
    position: absolute;
    content: "";
    height: 2px;
    width: 87%;
    background: gray;
    opacity: 0.5;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
  }

  .thanks-text {
    text-align: center;
    margin: 20px auto 0;
    line-height: 1.5;
    font-weight: 700;
    width: 87%;
    display: block;
  }

  .thanks-text-bold {
    font-weight: 700;
  }

  .thanks-text-bold-red {
    color: red;
    font-weight: 700;
  }

  .thanks-text-bold {
    font-weight: 700;
  }

  .thanks-text-bold-red {
    color: red;
    font-weight: 700;
  }
</style>
